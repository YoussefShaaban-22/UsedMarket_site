<link rel="stylesheet" href="./list-order.component.css">

<app-header></app-header>

<main id="main" class="main">
  <section class="section">
    <div class="row">
      <div class="col-lg-12">
        <div class="card">
          <div class="card-body">
            <div class="d-flex mt-3 mb-3 border-bottom border-dark">
              <h1 class="flex-grow-1 mb-3" id="text">Orders</h1>
            </div>
            <ng-container *ngIf="user.seller_id; else showall">
              <table class="table rowtable">
                <thead>
                  <tr>
                    <th style="width: 5%" scope="col">Order Id</th>
                    <th style="width: 10%" scope="col">User Name</th>
                    <th style="width: 10%" scope="col">User Phone</th>
                    <th style="width: 10%" scope="col">Product Name</th>
                    <th style="width: 5%" scope="col">Color</th>
                    <th style="width: 2%" scope="col">Qty</th>
                    <th style="width: 10%" scope="col">Total Product Price</th>
                    <th style="width: 5%" scope="col">Paid</th>
                    <th style="width: 5%" scope="col">Status</th>
                    <th style="width: 10%" scope="col">Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let order of groupedOrders">
                    <ng-container *ngFor="let item of order.products">
                      <ng-container *ngFor="let product of products">
                        <ng-container *ngIf="product.id === item.product_id && product.seller_id === user_sellerId">
                          <td style="width: 5%">{{ order.order_id }}</td>
                          <td style="width: 5%">
                            <ul>
                              <ng-container *ngFor="let user of users">
                                <ng-container *ngIf="order.users == user.id">
                                  <li>{{ user.name }}</li>
                                </ng-container>
                              </ng-container>
                            </ul>
                          </td>
                          <td style="width: 5%">
                            <ul>
                              <ng-container *ngFor="let user of users">
                                <ng-container *ngIf="order.users == user.id">
                                  <li>{{ user.phone }}</li>
                                </ng-container>
                              </ng-container>
                            </ul>
                          </td>
                        </ng-container>
                      </ng-container>
                    </ng-container>
                    <td style="width: 10%">
                      <ul>
                        <ng-container *ngFor="let item of order.products">
                          <ng-container *ngFor="let product of products">
                            <ng-container *ngIf="product.id === item.product_id && product.seller_id === user_sellerId">
                              <li>{{ product.name }}</li>

                            </ng-container>
                          </ng-container>
                        </ng-container>
                      </ul>
                    </td>
                    <td style="width: 5%">
                      <ul>
                        <ng-container *ngFor="let item of order.products">
                          <ng-container *ngFor="let product of products">
                            <ng-container *ngIf="product.id === item.product_id && product.seller_id === user_sellerId">
                              <li>{{ item.color }}</li>
                            </ng-container>
                          </ng-container>
                        </ng-container>
                      </ul>
                    </td>
                    <td style="width: 2%">
                      <ul>
                        <ng-container *ngFor="let item of order.products">
                          <ng-container *ngFor="let product of products">
                            <ng-container *ngIf="product.id === item.product_id && product.seller_id === user_sellerId">
                              <li>{{ item.quantity }}</li>
                            </ng-container>
                          </ng-container>
                        </ng-container>
                      </ul>
                    </td>
                    <td style="width: 5%">
                      <ul>
                        <ng-container *ngFor="let item of order.products">
                          <ng-container *ngFor="let product of products">
                            <ng-container *ngIf="product.id === item.product_id && product.seller_id === user_sellerId">
                              <li>{{ item.total_product_price }}</li>
                            </ng-container>
                          </ng-container>
                        </ng-container>
                      </ul>
                    </td>
                    <ng-container *ngFor="let item of order.products">
                      <ng-container *ngFor="let product of products">
                        <ng-container *ngIf="product.id === item.product_id && product.seller_id === user_sellerId">
                          <td style="width: 5%">{{ order.paid }}</td>
                          <td style="width: 5%">{{ order.status }}</td>
                          <td>
                            <button (click)="ShowOrder(order.order_id)" class="btn text-btn">Show All Details</button>
                          </td>
                        </ng-container>
                      </ng-container>
                    </ng-container>
                  </tr>
                </tbody>
              </table>
            </ng-container>

            <ng-template #showall>
              <table class="table rowtable">
                <thead>
                  <tr>
                    <th style="width: 5%" scope="col">Order Id</th>
                    <th style="width: 10%" scope="col">User Name</th>
                    <th style="width: 10%" scope="col">User Phone</th>
                    <th style="width: 10%" scope="col">Product Name</th>
                    <th style="width: 5%" scope="col">Color</th>
                    <th style="width: 2%" scope="col">Qty</th>
                    <th style="width: 10%" scope="col">Total Product Price</th>
                    <th style="width: 5%" scope="col">Paid</th>
                    <th style="width: 5%" scope="col">Status</th>
                    <th style="width: 10%" scope="col">Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let order of groupedOrders">
                    <td style="width: 5%">{{ order.order_id }}</td>
                    <td style="width: 5%">
                      <ul>
                        <ng-container *ngFor="let user of users">
                          <ng-container *ngIf="order.users == user.id">
                            <li>{{ user.name }}</li>
                          </ng-container>
                        </ng-container>
                      </ul>
                    </td>
                    <td style="width: 5%">
                      <ul>
                        <ng-container *ngFor="let user of users">
                          <ng-container *ngIf="order.users == user.id">
                            <li>{{ user.phone }}</li>
                          </ng-container>
                        </ng-container>
                      </ul>
                    </td>
                    <td style="width: 10%">
                      <ul>
                        <ng-container *ngFor="let item of order.products">
                          <ng-container *ngFor="let product of products">
                            <ng-container *ngIf="product.id == item.product_id">

                              <li>{{ product.name }}</li>

                            </ng-container>
                          </ng-container>
                        </ng-container>
                      </ul>
                    </td>
                    <td style="width: 5%">
                      <ul>
                        <li *ngFor="let item of order.products">{{ item.color }}</li>
                      </ul>
                    </td>
                    <td style="width: 2%">
                      <ul>
                        <li *ngFor="let item of order.products">{{ item.quantity }}</li>
                      </ul>
                    </td>
                    <td style="width: 5%">
                      <ul>
                        <li *ngFor="let item of order.products">{{ item.total_product_price }}</li>
                      </ul>
                    </td>
                    <td style="width: 5%">{{ order.paid }}</td>
                    <td style="width: 5%">{{ order.status }}</td>
                    <td>
                      <button (click)="ShowOrder(order.order_id)" class="btn text-btn">Show All Details</button>

                    </td>
                  </tr>
                </tbody>
              </table>
            </ng-template>
            <!-- End Table with stripped rows -->

          </div>
        </div>

      </div>
    </div>
  </section>

</main>
