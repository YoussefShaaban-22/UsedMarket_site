<link rel="stylesheet" href="./view-cart.component.css">
<app-navbar></app-navbar>


<div class="container">
  <div class="row">
    <div class="section-title">
      <h2>My Cart</h2>
    </div>
  </div>
  <div class="row cart" *ngFor="let mycart of carts">
    <ng-container *ngFor="let product of products">
      <ng-container *ngIf="product.id == mycart.product_id">
        <div class="col-md-4">
          <img [src]="product.thumbnail_image" alt="Product Image" class="img-fluid image">
        </div>
        <div class="col-md-4">
          <h3>{{product.name}}</h3>
          <span [innerHTML]="product.short_description"></span>
          <p>Color: <span>{{mycart.color}}</span></p>
          <p>Quantity: <span>{{mycart.quantity}}</span></p>
          <ng-container *ngIf="product.price != mycart.product_price; else noDiscount">
            <p>Price of product after discount: <span>{{mycart.product_price}}</span></p>
            <p>Total Price: <span>{{mycart.total_price}}</span></p>
          </ng-container>
          <ng-template #noDiscount>
            <p>Price of product: <span>{{mycart.product_price}}</span></p>
            <p>Total Price: <span>{{mycart.total_price}}</span></p>
          </ng-template>
        </div>
        <div class="col-md-4">
          <!-- Button trigger modal -->
          <button type="button" class="btn btn_view" data-bs-toggle="modal" [attr.data-bs-target]="'#cart'+mycart.id">
            Update Quantity
          </button>
          <!-- Modal Cart -->
          <div class="modal fade" [attr.id]="'cart'+mycart.id" data-bs-backdrop="static" data-bs-keyboard="false"
            tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="staticBackdropLabel">Update product in Cart</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <form (ngSubmit)="onSubmit(mycart.id,product.price)" #form="ngForm">
                    <div class="row">
                      <div class="col-md-12 mb-3">
                        <label class="form-label">Product Name</label>
                        <div class="quantity-control">
                          <input type="text" [value]="product.name" readonly name="quantity" />
                        </div>
                      </div>
                      <!-- Quantity Input -->
                      <div class="col-md-12 mb-3">
                        <label class="form-label">Quantity</label>
                        <div class="quantity-control">
                          <input type="number" [(ngModel)]="mycart.quantity" name="quantity" min="1"
                            [max]="product.quantity" />
                        </div>
                      </div>
                    </div>
                    <!-- Submit button -->
                    <button type="submit" class="btn btn-primary">Update</button>
                  </form>
                </div>
              </div>
            </div>
          </div>
          <a (click)="deletecart(mycart.id)" class="btn btn_remove">Remove</a>
        </div>
      </ng-container>
    </ng-container>
  </div>
</div>

<div class="container">
  <div class="row">
    <div class="section-title">
      <h2>Payment</h2>
    </div>
  </div>
  <div class="row cart">
    <div class="col-md-6">
      <h3 class="total">Total:</h3>
    </div>
    <div class="col-md-6">
      <h3 class="total"> {{TotalPriceOfCart}} EGP</h3>
    </div>
  </div>
</div>

<div class="container button">

  <div class="row">
    <div class="col-md-12 text-center">
      <button class="custom-btn" (click)="navigateToPayMethod()">Check Out</button>
    </div>
  </div>
  <div class="row mt-3">
    <div class="col-md-12 text-center">
      <button class="custom-btn" (click)="navigateToHome()">Continue Shopping</button>
    </div>
  </div>
</div>
<app-footer></app-footer>
